!function(){class e extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(e.content.cloneNode(!0))}$(e){return this.shadowRoot.querySelector(e)}$$(e){return this.shadowRoot.querySelectorAll(e)}}class t extends e{static get is(){return"acsv-file-select"}constructor(){super(document.body.querySelector(`#${t.is}-template`))}connectedCallback(){const e=this.$("input");e.addEventListener("change",this.onChange_.bind(this));this.$("slot").assignedElements()[0].addEventListener("click",()=>e.click())}onChange_(){const e=Array.from(this.$("input").files);0!==e.length&&this.dispatchEvent(new CustomEvent("files-selected",{composed:!0,detail:e}))}}customElements.define(t.is,t);class n extends e{constructor(){super(document.body.querySelector(`#${n.is}-template`)),this.task={file:null,json:null}}static get is(){return"acsv-demo-app"}connectedCallback(){this.$("acsv-file-select").addEventListener("files-selected",this.onFilesSelected_.bind(this)),this.$("#convert").addEventListener("click",this.onConvertClick_.bind(this)),this.$("#export").addEventListener("click",this.onExportClick_.bind(this)),this.$("#copy").addEventListener("click",this.onCopyClick_.bind(this))}onFilesSelected_(e){const t=e.detail[0];var n;this.task={file:t,json:null},(n=t,new Promise((function(e,t){const s=new FileReader;s.onloadend=function(){e(s.result)},s.onerror=t,s.readAsText(n)}))).then(e=>{const n=this.$("#input");t.size/Math.pow(10,6)<2?n.value=e:(n.value="",n.placeholder="Input file is larger than 2mb, hiding contents for better performance."),this.convert_(e)})}toggleDisabled_(e){for(const t of this.$$("button"))t.toggleAttribute("disabled",e)}onConvertClick_(){this.task={file:null,json:null},this.convert_(this.$("#input").value)}convert_(e){const t=this.$("#output");return t.value="Converting...",this.toggleDisabled_(!0),new Promise(n=>{setTimeout(()=>{const s=performance.now(),o=function(e,t){const n=[],s=[];let o=!1,i=0,l={},c=-1,r=0,a=!1,d=!1;function h(){const n='"'===e[r-1]?1:0;let a=e.substring(c+1+n,r-n);if(d&&(a=a.replace(/""/g,'"')),o){if(t){const e=t(s[i],a);void 0!==e&&(l[s[i]]=e)}else l[s[i]]=a;i++}else s.push(a);d=!1,c=r}function u(){h(),o?(n.push(l),l={},i=0):o=!0}for(;r<e.length;){const t=e[r];a?'"'===t?'"'===e[r+1]?(r+=2,d=!0):(a=!1,r++,r===e.length&&u()):r++:(","===t?h():'"'===t?a=!0:"\r"===t?(u(),r++,c=r):"\n"===t?u():r===e.length-1&&(r++,u()),r++)}return n}(e),i=performance.now();this.task.json=JSON.stringify(o,null,2);const l=performance.now(),c=null===this.task.file?0:this.task.file.size/Math.pow(10,6);if(this.toggleDisabled_(!1),c<2)t.value=this.task.json,this.$("#copy").disabled=!1;else{const e=`Conversion done!\nCSV to JS -> ${Math.round(i-s)}ms\nJS to JSON -> ${Math.round(l-i)}ms\nFile is larger than 2mb, hiding contents for better performance.\nClick 'Save to file...' to get the JSON data.`;t.value=e,this.$("#copy").disabled=!0}n()},2)})}onExportClick_(){const e=null!==this.task.file?this.task.file.name.replace(/\.csv$/,".json"):"achilles_csv_converter.json";!function(e,t){const n=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=t,o.click()}(this.task.json,e)}onCopyClick_(){this.$("#output").select(),document.execCommand("copy")}}customElements.define(n.is,n)}();